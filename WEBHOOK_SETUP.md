# Настройка вебхука в Битрикс24

Для работы скрипта нормализации данных сотрудников необходимо создать вебхук в Битрикс24.

## Создание вебхука

### 1. Вход в административную панель

1. Откройте ваш портал Битрикс24
2. Войдите как администратор
3. Перейдите в **Настройки** → **Настройки продукта**

### 2. Создание вебхука

1. В левом меню выберите **Интеграция** → **Вебхуки**
2. Нажмите **Создать вебхук**
3. Заполните форму:

   **Основные настройки:**
   - **Название:** Нормализация сотрудников
   - **Описание:** Вебхук для нормализации данных сотрудников
   - **Домен:** Ваш домен Битрикс24

   **Права доступа:**
   - ✅ **Пользователи** - чтение и запись
   - ✅ **Структура компании** - чтение и запись

   **Дополнительно:**
   - **IP адреса:** Оставьте пустым (или укажите IP сервера)
   - **Активен:** ✅

4. Нажмите **Сохранить**

### 3. Получение URL вебхука

После создания вебхука вы получите URL вида:
```
https://your-domain.bitrix24.ru/rest/1/webhook_key/
```

**Сохраните этот URL!** Он понадобится для запуска скрипта нормализации.

## Проверка вебхука

### Тест через браузер

Откройте в браузере:
```
https://your-domain.bitrix24.ru/rest/1/webhook_key/user.get
```

Должен вернуться JSON с данными пользователей.

### Тест через curl

```bash
curl -X POST "https://your-domain.bitrix24.ru/rest/1/webhook_key/user.get" \
  -H "Content-Type: application/json" \
  -d '{"ACTIVE": true, "FIELDS": ["ID", "NAME", "SECOND_NAME", "LAST_NAME"]}'
```

## Безопасность

### Рекомендации по безопасности

1. **Ограничьте IP адреса** - укажите IP сервера, с которого будет запускаться скрипт
2. **Минимальные права** - дайте вебхуку только необходимые права
3. **Регулярная смена** - периодически меняйте ключ вебхука
4. **Мониторинг** - следите за использованием вебхука в логах

### Удаление вебхука

Если вебхук больше не нужен:
1. Перейдите в **Настройки** → **Интеграция** → **Вебхуки**
2. Найдите созданный вебхук
3. Нажмите **Удалить**

## Примеры использования

### Получение списка пользователей

```python
import requests

webhook_url = "https://your-domain.bitrix24.ru/rest/1/webhook_key/"
response = requests.post(f"{webhook_url}/user.get", json={
    "ACTIVE": True,
    "FIELDS": ["ID", "NAME", "SECOND_NAME", "LAST_NAME"]
})

users = response.json().get("result", [])
for user in users:
    print(f"ID: {user['ID']}, Имя: {user['NAME']}")
```

### Обновление пользователя

```python
response = requests.post(f"{webhook_url}/user.update", json={
    "ID": 123,
    "FIELDS": {
        "NAME": "Иван",
        "SECOND_NAME": "Сергеевич"
    }
})
```

## Устранение неполадок

### Ошибка "Доступ запрещен"

1. Проверьте правильность URL вебхука
2. Убедитесь, что вебхук активен
3. Проверьте права доступа вебхука

### Ошибка "Метод не найден"

1. Проверьте правильность названия метода API
2. Убедитесь, что у вебхука есть права на этот метод

### Ошибка "Недостаточно прав"

1. Проверьте права доступа вебхука
2. Убедитесь, что у пользователя есть права на операции с пользователями

## Ссылки

- [Документация API Битрикс24](https://dev.1c-bitrix.ru/api_d7/)
- [Справочник методов API](https://dev.1c-bitrix.ru/api_d7/rest/)
- [Безопасность вебхуков](https://dev.1c-bitrix.ru/api_d7/rest/security/)
